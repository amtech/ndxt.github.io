<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>VuePress</title>
    
    
    <link rel="preload" href="/assets/css/53.styles.73c7797a.css" as="style"><link rel="preload" href="/assets/js/app.2b7bf2f1.js" as="script"><link rel="preload" href="/assets/js/43.91307f1b.js" as="script"><link rel="prefetch" href="/assets/js/21.493656e1.js"><link rel="prefetch" href="/assets/js/0.8c6cb2b1.js"><link rel="prefetch" href="/assets/js/1.8d122193.js"><link rel="prefetch" href="/assets/js/2.da38c94d.js"><link rel="prefetch" href="/assets/js/3.7ba6dd4e.js"><link rel="prefetch" href="/assets/js/4.98f99baa.js"><link rel="prefetch" href="/assets/js/5.675307fa.js"><link rel="prefetch" href="/assets/js/6.0e2f11c8.js"><link rel="prefetch" href="/assets/js/7.59d873a0.js"><link rel="prefetch" href="/assets/js/8.606c9271.js"><link rel="prefetch" href="/assets/js/9.a25aea9f.js"><link rel="prefetch" href="/assets/js/10.2e240b38.js"><link rel="prefetch" href="/assets/js/11.69d46380.js"><link rel="prefetch" href="/assets/js/12.8666a845.js"><link rel="prefetch" href="/assets/js/13.fb9fa187.js"><link rel="prefetch" href="/assets/js/14.8cb80df4.js"><link rel="prefetch" href="/assets/js/15.3291b330.js"><link rel="prefetch" href="/assets/js/16.b051d1ed.js"><link rel="prefetch" href="/assets/js/17.a7e106c7.js"><link rel="prefetch" href="/assets/js/18.9d38a6f7.js"><link rel="prefetch" href="/assets/js/19.c5a8b8f0.js"><link rel="prefetch" href="/assets/js/20.b2b2e123.js"><link rel="prefetch" href="/assets/js/22.15a5ad8a.js"><link rel="prefetch" href="/assets/js/23.cd702e46.js"><link rel="prefetch" href="/assets/js/24.f6c597b9.js"><link rel="prefetch" href="/assets/js/25.6b4f6e65.js"><link rel="prefetch" href="/assets/js/26.10a40be6.js"><link rel="prefetch" href="/assets/js/27.cdfdf4a3.js"><link rel="prefetch" href="/assets/js/28.170fbd88.js"><link rel="prefetch" href="/assets/js/29.874f2874.js"><link rel="prefetch" href="/assets/js/30.8c2f80d9.js"><link rel="prefetch" href="/assets/js/31.3881f235.js"><link rel="prefetch" href="/assets/js/32.68859a3e.js"><link rel="prefetch" href="/assets/js/33.8bba4ee1.js"><link rel="prefetch" href="/assets/js/34.38351c6b.js"><link rel="prefetch" href="/assets/js/35.4efe87b7.js"><link rel="prefetch" href="/assets/js/36.0a2188a4.js"><link rel="prefetch" href="/assets/js/37.3197e625.js"><link rel="prefetch" href="/assets/js/38.d5a0ea00.js"><link rel="prefetch" href="/assets/js/39.eb7ebd4d.js"><link rel="prefetch" href="/assets/js/40.2b2b571a.js"><link rel="prefetch" href="/assets/js/41.39f09d33.js"><link rel="prefetch" href="/assets/js/42.423da9a7.js"><link rel="prefetch" href="/assets/js/44.457017c3.js"><link rel="prefetch" href="/assets/js/45.38dd7ecf.js"><link rel="prefetch" href="/assets/js/46.8c8ddb07.js"><link rel="prefetch" href="/assets/js/47.3c660fb3.js"><link rel="prefetch" href="/assets/js/48.2a80bd22.js"><link rel="prefetch" href="/assets/js/49.49314a9f.js"><link rel="prefetch" href="/assets/js/50.8c10f143.js"><link rel="prefetch" href="/assets/js/51.258a80e6.js"><link rel="prefetch" href="/assets/js/52.d4216a4c.js">
    <link rel="stylesheet" href="/assets/css/53.styles.73c7797a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar no-sidebar"><!----><div class="sidebar"><!----><ul class="sidebar-links"><li><a href="/GUIDE.html" class="sidebar-link">/GUIDE.html</a></li><li><a href="/QandA.html" class="sidebar-link">常见问题及解决办法</a></li><li><a href="/" class="sidebar-link">/</a></li><li><a href="/UPDATE_LOG.html" class="sidebar-link">历史更新记录</a></li><li><a href="/pieces/data_drive_sql_1.html" class="sidebar-link">动机</a></li><li><a href="/pieces/data_drive_sql_2.html" class="sidebar-link">动机</a></li><li><a href="/pieces/data_drive_sql_3.html" class="sidebar-link">动机</a></li><li><a href="/pieces/data_drive_sql_4.html" class="sidebar-link">动机</a></li><li><a href="/pieces/framework_1.html" class="active sidebar-link">适用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pieces/framework_10.html#功能权限" class="sidebar-link">功能权限</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_10.html#数据范围权限" class="sidebar-link">数据范围权限</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_10.html#业务流程权限" class="sidebar-link">业务流程权限</a></li></ul></li><li><a href="/pieces/framework_10.html" class="active sidebar-link">/pieces/framework_10.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pieces/framework_10.html#responsebody-注解" class="sidebar-link">ResponseBody 注解</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_10.html#不使用spring-mvc的情况" class="sidebar-link">不使用spring mvc的情况</a></li></ul></li><li><a href="/pieces/framework_11.html" class="sidebar-link">/pieces/framework_11.html</a></li><li><a href="/pieces/framework_2.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_3.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_4.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_5.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_6.html" class="sidebar-link">/pieces/framework_6.html</a></li><li><a href="/pieces/framework_7.html" class="sidebar-link">/pieces/framework_7.html</a></li><li><a href="/pieces/framework_8.html" class="sidebar-link">/pieces/framework_8.html</a></li><li><a href="/pieces/framework_9.html" class="sidebar-link">/pieces/framework_9.html</a></li><li><a href="/pieces/huan_cun.html" class="sidebar-link">动机</a></li><li><a href="/pieces/lexer_java.html" class="sidebar-link">动机</a></li><li><a href="/pieces/multi_datasource.html" class="sidebar-link">动机</a></li><li><a href="/pieces/page_query_1.html" class="sidebar-link">动机</a></li><li><a href="/pieces/page_query_2.html" class="sidebar-link">动机</a></li><li><a href="/pieces/permutation_combination.html" class="sidebar-link">动机</a></li><li><a href="/pieces/sort_as_tree.html" class="sidebar-link">问题</a></li><li><a href="/pieces/spring_jdbc_jpa.html" class="sidebar-link">动机</a></li><li><a href="/projects/" class="sidebar-link">项目总体介绍</a></li><li><a href="/projects/centit-cas.html" class="sidebar-link">单点登录CAS</a></li><li><a href="/projects/centit-compiler.html" class="sidebar-link">表达式编译器</a></li><li><a href="/projects/centit-database.html" class="sidebar-link">数据库通用算法</a></li><li><a href="/projects/centit-dde.html" class="sidebar-link">数据交换工具</a></li><li><a href="/projects/centit-fileserver.html" class="sidebar-link">文件服务器</a></li><li><a href="/projects/centit-framework-cloud.html" class="sidebar-link">框架spring cloud版本</a></li><li><a href="/projects/centit-framework-system.html" class="sidebar-link">框架系统管理平台</a></li><li><a href="/projects/centit-framework.html" class="sidebar-link">研发框架</a></li><li><a href="/projects/centit-integration-platform.html" class="sidebar-link">集成平台</a></li><li><a href="/projects/centit-meta-form.html" class="sidebar-link">自定义表单服务</a></li><li><a href="/projects/centit-msgpusher.html" class="sidebar-link">消息推送服务</a></li><li><a href="/projects/centit-presistence.html" class="sidebar-link">数据库持久化公共类</a></li><li><a href="/projects/centit-scaffold.html" class="sidebar-link">代码脚手架</a></li><li><a href="/projects/centit-search.html" class="sidebar-link">全文检索类</a></li><li><a href="/projects/centit-stat.html" class="sidebar-link">统计报表服务</a></li><li><a href="/projects/centit-ui-easyui.html" class="sidebar-link">基于EasyUI的前段框架</a></li><li><a href="/projects/centit-ui-vue.html" class="sidebar-link">基于Vue的前段框架</a></li><li><a href="/projects/centit-utils.html" class="sidebar-link">基础算法类</a></li><li><a href="/projects/centit-webim.html" class="sidebar-link">即时通讯</a></li><li><a href="/projects/centit-workflow.html" class="sidebar-link">工作流引擎</a></li><li><a href="/projects/centit-workorder.html" class="sidebar-link">工单系统</a></li><li><a href="/system_design/" class="sidebar-link">框架的总体设计</a></li><li><a href="/system_design/concept_design.html" class="sidebar-link">概念设计</a></li><li><a href="/system_design/product_design.html" class="sidebar-link">产品设计</a></li><li><a href="/system_design/technical_design.html" class="sidebar-link">技术路线</a></li></ul></div><div class="page"><div class="content"><h1 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h1><p>框架是基于前后端分离的架构思想开发的，后端以restful风格url提供返回json格式的数据服务。框架对返回结果的形式做了一个约定，返回形式如下的json：</p><pre class="language-text"><code>{
    code:'integer 型，0 表示成功，其他均为错误代码， 不可以为空',
    message:'code=0：消息：code!=0:错误信息。 也可以为空',
    data:'any 可以是简单的一个数字，也可以是一个复杂的对象，Map等等，甚至可以为 null'
}
</code></pre><p>客户端获取返回结果首先判断code的值，如果是0再从data中获取真正的返回数据。</p><h1 id="服务端开发最佳实践"><a href="#服务端开发最佳实践" aria-hidden="true" class="header-anchor">#</a> 服务端开发最佳实践</h1><p>先用一段代码来展示一下：</p><pre class="language-java"><code>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;根据学号查询学生&quot;</span><span class="token punctuation">,</span>notes<span class="token operator">=</span><span class="token string">&quot;根据学号查询学生。&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiImplicitParams</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;studNo&quot;</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">&quot;学号必须是两位数&quot;</span><span class="token punctuation">,</span>
        required<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span> paramType <span class="token operator">=</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span><span class="token string">&quot;String&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/student/{studNo}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@WrapUpResponseBody</span>
    <span class="token keyword">public</span> Student <span class="token function">findStudent</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> String studNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span>studNo<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ObjectException</span><span class="token punctuation">(</span>studNo<span class="token punctuation">,</span>
                ObjectException<span class="token punctuation">.</span>DATA_NOT_FOUND_EXCEPTION<span class="token punctuation">,</span>
                <span class="token string">&quot;找不到对应学号的学生&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Student stud <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stud<span class="token punctuation">.</span><span class="token function">setStudNo</span><span class="token punctuation">(</span>studNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        stud<span class="token punctuation">.</span><span class="token function">setStudName</span><span class="token punctuation">(</span><span class="token string">&quot;小强&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> stud<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><p>说明：</p><ol><li>@WrapUpResponseBody 注解会将返回的结果转化为json，并添加code和message部分。</li><li>框架会统一对异常进行处理，将ObjectException异常中的 data,code,error(message)转化为json格式，如果式普通的异常code=500,data为null。</li></ol><h1 id="其他实现方式"><a href="#其他实现方式" aria-hidden="true" class="header-anchor">#</a> 其他实现方式</h1><p>除了用WrapUpResponseBody注解的方式，用其他的方式也可以，只要保证返回的格式和约定的一致就行。</p><h2 id="responsebody-注解"><a href="#responsebody-注解" aria-hidden="true" class="header-anchor">#</a> ResponseBody 注解</h2><p>框架定义了<a href="https://github.com/ndxt/centit-framework/blob/master/framework-adapter/src/main/java/com/centit/framework/common/ResponseData.java" target="_blank" rel="noopener noreferrer">ResponseData</a>接口，并作了两个的实现。同样上面的示例：</p><pre class="language-java"><code>        <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/student2/{studNo}&quot;</span><span class="token punctuation">)</span>
        <span class="token annotation punctuation">@ResponseBody</span>
        <span class="token keyword">public</span> ResponseData <span class="token function">findStudent2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> String studNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span>studNo<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">/*throw new ObjectException(studNo,
                    ObjectException.DATA_NOT_FOUND_EXCEPTION,
                    &quot;找不到对应学号的学生&quot;);*/</span>
                <span class="token comment">//直接返回错误数据，和上面的throw在返回结果上是等价的。</span>
                <span class="token keyword">return</span> ResponseData<span class="token punctuation">.</span><span class="token function">makeErrorMessageWithData</span><span class="token punctuation">(</span>studNo<span class="token punctuation">,</span>
                    ObjectException<span class="token punctuation">.</span>DATA_NOT_FOUND_EXCEPTION<span class="token punctuation">,</span>
                    <span class="token string">&quot;找不到对应学号的学生&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            Student stud <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stud<span class="token punctuation">.</span><span class="token function">setStudNo</span><span class="token punctuation">(</span>studNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            stud<span class="token punctuation">.</span><span class="token function">setStudName</span><span class="token punctuation">(</span><span class="token string">&quot;小强&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ResponseData<span class="token punctuation">.</span><span class="token function">makeResponseData</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

</code></pre><p>这个实现方式和上面注解方是等价的，说明：</p><ol><li>和WrapUpResponseBody注解示例主要的区别式返回类型不同，这个有一个缺点就是Swagger2的文档说明中无法展示真正返回数据Student的结构。</li><li>错误处理部分依然可以使用 throw 异常的形式，这里只是突出另一种写法。</li></ol><h2 id="不使用spring-mvc的情况"><a href="#不使用spring-mvc的情况" aria-hidden="true" class="header-anchor">#</a> 不使用spring mvc的情况</h2><p>框架实现了一个返回结果的工具类<a href="https://github.com/ndxt/centit-framework/blob/master/framework-adapter/src/main/java/com/centit/framework/common/JsonResultUtils.java" target="_blank" rel="noopener noreferrer">JsonResultUtils</a>可以直接对response中的outputStream进行操作，这样根加灵活，直接上代码：</p><pre class="language-java"><code>    <span class="token comment">// 返回错误，这个参数的顺序和上面的有点不一致</span>
    JsonResultUtils<span class="token punctuation">.</span><span class="token function">writeSingleErrorDataJson</span><span class="token punctuation">(</span><span class="token number">604</span><span class="token punctuation">,</span><span class="token string">&quot;找不到对应学号的学生&quot;</span><span class="token punctuation">,</span> studNo<span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回正确数据</span>
    JsonResultUtils<span class="token punctuation">.</span><span class="token function">writeSingleDataJson</span><span class="token punctuation">(</span>stud<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//也可以构建 ResponseData 对象</span>
    JsonResultUtils<span class="token punctuation">.</span><span class="token function">writeResponseDataAsJson</span><span class="token punctuation">(</span>ResponseData<span class="token punctuation">.</span><span class="token function">makeResponseData</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span>
</code></pre></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/pieces/framework_1.html" class="prev">
          适用场景
        </a></span><span class="next"><a href="/pieces/framework_11.html">
          /pieces/framework_11.html
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/43.91307f1b.js" defer></script><script src="/assets/js/app.2b7bf2f1.js" defer></script>
  </body>
</html>
