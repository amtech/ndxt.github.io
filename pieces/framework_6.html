<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>VuePress</title>
    
    
    <link rel="preload" href="/assets/css/53.styles.73c7797a.css" as="style"><link rel="preload" href="/assets/js/app.2b7bf2f1.js" as="script"><link rel="preload" href="/assets/js/37.3197e625.js" as="script"><link rel="prefetch" href="/assets/js/21.493656e1.js"><link rel="prefetch" href="/assets/js/0.8c6cb2b1.js"><link rel="prefetch" href="/assets/js/1.8d122193.js"><link rel="prefetch" href="/assets/js/2.da38c94d.js"><link rel="prefetch" href="/assets/js/3.7ba6dd4e.js"><link rel="prefetch" href="/assets/js/4.98f99baa.js"><link rel="prefetch" href="/assets/js/5.675307fa.js"><link rel="prefetch" href="/assets/js/6.0e2f11c8.js"><link rel="prefetch" href="/assets/js/7.59d873a0.js"><link rel="prefetch" href="/assets/js/8.606c9271.js"><link rel="prefetch" href="/assets/js/9.a25aea9f.js"><link rel="prefetch" href="/assets/js/10.2e240b38.js"><link rel="prefetch" href="/assets/js/11.69d46380.js"><link rel="prefetch" href="/assets/js/12.8666a845.js"><link rel="prefetch" href="/assets/js/13.fb9fa187.js"><link rel="prefetch" href="/assets/js/14.8cb80df4.js"><link rel="prefetch" href="/assets/js/15.3291b330.js"><link rel="prefetch" href="/assets/js/16.b051d1ed.js"><link rel="prefetch" href="/assets/js/17.a7e106c7.js"><link rel="prefetch" href="/assets/js/18.9d38a6f7.js"><link rel="prefetch" href="/assets/js/19.c5a8b8f0.js"><link rel="prefetch" href="/assets/js/20.b2b2e123.js"><link rel="prefetch" href="/assets/js/22.15a5ad8a.js"><link rel="prefetch" href="/assets/js/23.cd702e46.js"><link rel="prefetch" href="/assets/js/24.f6c597b9.js"><link rel="prefetch" href="/assets/js/25.6b4f6e65.js"><link rel="prefetch" href="/assets/js/26.10a40be6.js"><link rel="prefetch" href="/assets/js/27.cdfdf4a3.js"><link rel="prefetch" href="/assets/js/28.170fbd88.js"><link rel="prefetch" href="/assets/js/29.874f2874.js"><link rel="prefetch" href="/assets/js/30.8c2f80d9.js"><link rel="prefetch" href="/assets/js/31.3881f235.js"><link rel="prefetch" href="/assets/js/32.68859a3e.js"><link rel="prefetch" href="/assets/js/33.8bba4ee1.js"><link rel="prefetch" href="/assets/js/34.38351c6b.js"><link rel="prefetch" href="/assets/js/35.4efe87b7.js"><link rel="prefetch" href="/assets/js/36.0a2188a4.js"><link rel="prefetch" href="/assets/js/38.d5a0ea00.js"><link rel="prefetch" href="/assets/js/39.eb7ebd4d.js"><link rel="prefetch" href="/assets/js/40.2b2b571a.js"><link rel="prefetch" href="/assets/js/41.39f09d33.js"><link rel="prefetch" href="/assets/js/42.423da9a7.js"><link rel="prefetch" href="/assets/js/43.91307f1b.js"><link rel="prefetch" href="/assets/js/44.457017c3.js"><link rel="prefetch" href="/assets/js/45.38dd7ecf.js"><link rel="prefetch" href="/assets/js/46.8c8ddb07.js"><link rel="prefetch" href="/assets/js/47.3c660fb3.js"><link rel="prefetch" href="/assets/js/48.2a80bd22.js"><link rel="prefetch" href="/assets/js/49.49314a9f.js"><link rel="prefetch" href="/assets/js/50.8c10f143.js"><link rel="prefetch" href="/assets/js/51.258a80e6.js"><link rel="prefetch" href="/assets/js/52.d4216a4c.js">
    <link rel="stylesheet" href="/assets/css/53.styles.73c7797a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar no-sidebar"><!----><div class="sidebar"><!----><ul class="sidebar-links"><li><a href="/GUIDE.html" class="sidebar-link">/GUIDE.html</a></li><li><a href="/QandA.html" class="sidebar-link">常见问题及解决办法</a></li><li><a href="/" class="sidebar-link">/</a></li><li><a href="/UPDATE_LOG.html" class="sidebar-link">历史更新记录</a></li><li><a href="/pieces/data_drive_sql_1.html" class="sidebar-link">动机</a></li><li><a href="/pieces/data_drive_sql_2.html" class="sidebar-link">动机</a></li><li><a href="/pieces/data_drive_sql_3.html" class="sidebar-link">动机</a></li><li><a href="/pieces/data_drive_sql_4.html" class="sidebar-link">动机</a></li><li><a href="/pieces/framework_1.html" class="sidebar-link">适用场景</a></li><li><a href="/pieces/framework_10.html" class="sidebar-link">/pieces/framework_10.html</a></li><li><a href="/pieces/framework_11.html" class="sidebar-link">/pieces/framework_11.html</a></li><li><a href="/pieces/framework_2.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_3.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_4.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_5.html" class="sidebar-link">概述</a></li><li><a href="/pieces/framework_6.html" class="active sidebar-link">/pieces/framework_6.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pieces/framework_6.html#认证方式配置" class="sidebar-link">认证方式配置</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_6.html#密码加密方式" class="sidebar-link">密码加密方式</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_6.html#session的内容" class="sidebar-link">session的内容</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_6.html#session持久化" class="sidebar-link">session持久化</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_6.html#登录方式" class="sidebar-link">登录方式</a></li><li class="sidebar-sub-header"><a href="/pieces/framework_6.html#身份识别" class="sidebar-link">身份识别</a></li></ul></li><li><a href="/pieces/framework_7.html" class="sidebar-link">/pieces/framework_7.html</a></li><li><a href="/pieces/framework_8.html" class="sidebar-link">/pieces/framework_8.html</a></li><li><a href="/pieces/framework_9.html" class="sidebar-link">/pieces/framework_9.html</a></li><li><a href="/pieces/huan_cun.html" class="sidebar-link">动机</a></li><li><a href="/pieces/lexer_java.html" class="sidebar-link">动机</a></li><li><a href="/pieces/multi_datasource.html" class="sidebar-link">动机</a></li><li><a href="/pieces/page_query_1.html" class="sidebar-link">动机</a></li><li><a href="/pieces/page_query_2.html" class="sidebar-link">动机</a></li><li><a href="/pieces/permutation_combination.html" class="sidebar-link">动机</a></li><li><a href="/pieces/sort_as_tree.html" class="sidebar-link">问题</a></li><li><a href="/pieces/spring_jdbc_jpa.html" class="sidebar-link">动机</a></li><li><a href="/projects/" class="sidebar-link">项目总体介绍</a></li><li><a href="/projects/centit-cas.html" class="sidebar-link">单点登录CAS</a></li><li><a href="/projects/centit-compiler.html" class="sidebar-link">表达式编译器</a></li><li><a href="/projects/centit-database.html" class="sidebar-link">数据库通用算法</a></li><li><a href="/projects/centit-dde.html" class="sidebar-link">数据交换工具</a></li><li><a href="/projects/centit-fileserver.html" class="sidebar-link">文件服务器</a></li><li><a href="/projects/centit-framework-cloud.html" class="sidebar-link">框架spring cloud版本</a></li><li><a href="/projects/centit-framework-system.html" class="sidebar-link">框架系统管理平台</a></li><li><a href="/projects/centit-framework.html" class="sidebar-link">研发框架</a></li><li><a href="/projects/centit-integration-platform.html" class="sidebar-link">集成平台</a></li><li><a href="/projects/centit-meta-form.html" class="sidebar-link">自定义表单服务</a></li><li><a href="/projects/centit-msgpusher.html" class="sidebar-link">消息推送服务</a></li><li><a href="/projects/centit-presistence.html" class="sidebar-link">数据库持久化公共类</a></li><li><a href="/projects/centit-scaffold.html" class="sidebar-link">代码脚手架</a></li><li><a href="/projects/centit-search.html" class="sidebar-link">全文检索类</a></li><li><a href="/projects/centit-stat.html" class="sidebar-link">统计报表服务</a></li><li><a href="/projects/centit-ui-easyui.html" class="sidebar-link">基于EasyUI的前段框架</a></li><li><a href="/projects/centit-ui-vue.html" class="sidebar-link">基于Vue的前段框架</a></li><li><a href="/projects/centit-utils.html" class="sidebar-link">基础算法类</a></li><li><a href="/projects/centit-webim.html" class="sidebar-link">即时通讯</a></li><li><a href="/projects/centit-workflow.html" class="sidebar-link">工作流引擎</a></li><li><a href="/projects/centit-workorder.html" class="sidebar-link">工单系统</a></li><li><a href="/system_design/" class="sidebar-link">框架的总体设计</a></li><li><a href="/system_design/concept_design.html" class="sidebar-link">概念设计</a></li><li><a href="/system_design/product_design.html" class="sidebar-link">产品设计</a></li><li><a href="/system_design/technical_design.html" class="sidebar-link">技术路线</a></li></ul></div><div class="page"><div class="content"><h1 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h1><p>先腾框架的安全体系采用了spring security的框架。本文主要阐述框架中在身份认证和session管理方面的考虑。</p><h1 id="身份认证"><a href="#身份认证" aria-hidden="true" class="header-anchor">#</a> 身份认证</h1><h2 id="认证方式配置"><a href="#认证方式配置" aria-hidden="true" class="header-anchor">#</a> 认证方式配置</h2><p>Spring security提供了多种认证方式：ldap、用户名密码、cas单点登录、OAuth等等，非常灵活，我们只需要做响应的配置就可以了。日常中我们用的最多的就是用户名密码和单点登录。所以框架<a href="https://github.com/ndxt/centit-framework/tree/master/framework-config" target="_blank" rel="noopener noreferrer">framework-config</a>中实现了这两个类验证的配置方式，开发人员只要在属性文件中配置以下内容就可以了。</p><pre class="language-text"><code># 启动用户名密码验证
login.dao.enable= true
# 启动cas单点登录认证
login.cas.enable= false
login.cas.localHome = http://localhost:8085/framework
login.cas.casHome = http://localhost:8080/centit-cas
</code></pre><p>如果使用其他的配置方式就需要将这两个属性都配置为false，然后自行编写对应的配置类。</p><h2 id="密码加密方式"><a href="#密码加密方式" aria-hidden="true" class="header-anchor">#</a> 密码加密方式</h2><p>使用用户名密码配置时，密码是要加密为密文存储的，笔者认为一个好的密码加密方式应该具备一下特点：</p><ol><li>密文不可逆，就是无法从密文知道密码，这个一般用散列的方式，比如：md5，SHA-1等散列算法。</li><li>相同的密码密文不能都是一样，所以一般在散列算法中“加盐”，并且为了提高破解难度可能会多次散列。</li><li>不同用户的密文不能通用，就是一个用户密文复制到另外一个用户名下，不能使用，这个可以将2中的盐和用户的主键关联。</li></ol><p>Spring security 4.* 版本以后推荐使用 org.springframework.security.crypto.password.PasswordEncoder 不支持上面的3特性，而之前 org.springframework.security.authentication.encoding.PasswordEncoder 是支持用户属性作为盐的。Spring 的理由是“ better accommodates best practice of randomly generated salt that is included with the  password.” 好在这两个接口都得以保留。框架同时实现了这两个接口，开发人员可以根据自己的需求选择。开发人员只要定义，源码参见<a href="https://github.com/ndxt/centit-framework/tree/master/framework-core/src/main/java/com/centit/framework/security/model" target="_blank" rel="noopener noreferrer">framework-core</a> ，通过bean的形式注入到框架中:</p><pre class="language-java"><code> 	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;passwordEncoder&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> Object <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token comment">// org.springframework.security.crypto.password.PasswordEncoder </span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StandardPasswordEncoderImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// org.springframework.security.authentication.encoding.PasswordEncoder </span>
        <span class="token comment">//return new CentitPasswordEncoderImpl();</span>
    <span class="token punctuation">}</span>
</code></pre><h1 id="session管理"><a href="#session管理" aria-hidden="true" class="header-anchor">#</a> session管理</h1><h2 id="session的内容"><a href="#session的内容" aria-hidden="true" class="header-anchor">#</a> session的内容</h2><p>用户登录后框架会创建一个 <a href="https://github.com/ndxt/centit-framework/blob/master/framework-core/src/main/java/com/centit/framework/security/model/CentitUserDetails.java" target="_blank" rel="noopener noreferrer">CentitUserDetails</a> 对象。它包含：</p><ol><li>用户的基本信息</li><li>用户的岗位信息</li><li>用户的权限信息</li><li>用户的角色列表</li><li>用户的设置信息</li></ol><h2 id="session持久化"><a href="#session持久化" aria-hidden="true" class="header-anchor">#</a> session持久化</h2><p>Session可以存放在内存中，也可以存放在数据库比如H2或者Redis数据库中。需要实现<a href="https://github.com/ndxt/centit-framework/blob/master/framework-core/src/main/java/com/centit/framework/security/model/MemorySessionRegistryImpl.java" target="_blank" rel="noopener noreferrer">SessionRegistry</a> 接口。</p><h1 id="用户登录"><a href="#用户登录" aria-hidden="true" class="header-anchor">#</a> 用户登录</h1><h2 id="登录方式"><a href="#登录方式" aria-hidden="true" class="header-anchor">#</a> 登录方式</h2><ol><li>系统集成的spring security 有多种登录方式，可以通过配置实现用户名密码登录、ldap登录、cas单点登录等等。</li><li>为了提供进程间通讯，提供给应用程序客户端的登录方式&quot;/system/mainframe/loginasclient&quot;这个和spring security 提供的login接口一样，不同的是这个提供了特别的授权方式，让登录的服务可以访问系统提供的服务接口。</li><li>第三方认证互信接口&quot;/system/mainframe/loginasthird&quot;，调用这个接口需要提供ThirdPartyCheckUserDetails类型的bean它需要开发人员自己实现第三方认证机制。</li></ol><h2 id="身份识别"><a href="#身份识别" aria-hidden="true" class="header-anchor">#</a> 身份识别</h2><p>一般请求可以通过携带cookie的方式来说明自己的身份，在无法使用cookie的情况下可以在request的header的Authorization属性中设置token，这个token在用户以ajax形式认证时服务器返回的信息中包括这个值，客户端需要保存好这个token。</p></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/pieces/framework_5.html" class="prev">
          概述
        </a></span><span class="next"><a href="/pieces/framework_7.html">
          /pieces/framework_7.html
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/37.3197e625.js" defer></script><script src="/assets/js/app.2b7bf2f1.js" defer></script>
  </body>
</html>
